<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线供佛 - 明光 (私人修持版)</title>
    <style>
        /* --- 基礎設定 --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #1a1a1a;
            font-family: "Microsoft YaHei", "Heiti SC", sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- 主容器 --- */
        #app {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 100vh;
            background: #2b0c0c;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- 背景層 --- */
        .bg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://mingguang.im/gongfo/assets/img/bg.jpg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center top;
            z-index: 1;
            filter: brightness(0.3);
            transition: filter 2s ease-in-out;
        }

        /* --- 佛像層 (向上調整位置) --- */
        .buddha-layer {
            position: absolute;
            top: 5%; /* 從 15% 調整為 5%，整體向上 */
            left: 50%;
            transform: translateX(-50%);
            width: 55%;
            max-width: 450px;
            z-index: 2;
            text-align: center;
        }

        /* 直式螢幕優化佛像比例 (向上調整位置) */
        @media screen and (max-aspect-ratio: 1/1) {
            .buddha-layer {
                width: 75%;
                top: 8%; /* 從 18% 調整為 8%，整體向上 */
            }
        }

        .buddha-img {
            width: 100%;
            height: auto;
            filter: brightness(0.6) drop-shadow(0 0 10px rgba(255,215,0,0.3));
            /* 加入 opacity 漸變，讓切換佛像時有淡入淡出效果 */
            transition: filter 2s ease-in-out, opacity 0.5s ease-in-out;
            display: block;
            opacity: 1;
        }

        /* --- 開燈狀態 --- */
        #app.light-up .bg-layer { filter: brightness(1.0); }
        #app.light-up .buddha-img { filter: brightness(1.0) drop-shadow(0 0 30px rgba(255,215,0,0.7)); }

        /* --- 供品層 (維持原始正確排版) --- */
        .offerings-layer {
            position: absolute;
            bottom: 25%;
            left: 0;
            width: 100%;
            height: 300px;
            z-index: 3;
            pointer-events: none;
        }

        .offering {
            position: absolute;
            opacity: 0;
            transition: opacity 1s ease-in-out, transform 1s ease-in-out;
            bottom: 0;
        }
        .offering.show { opacity: 1; }

        /* 各項供品定位 (原始精準數值) */
        .lamp-left { left: 2%; bottom: -7px; width: 15%; max-width: 100px; z-index: 10; }
        .lamp-right { right: 2%; bottom: -7px; width: 15%; max-width: 100px; z-index: 10; }
        .water-bowl { left: 50%; transform: translateX(-50%); bottom: -160px; width: 85%; max-width: 500px; z-index: 50; }
        .incense-burner { left: 50%; transform: translateX(-50%); bottom: -90px; width: 18%; max-width: 110px; z-index: 55; }
        .flower-vase-left { left: 2%; bottom: -160px; width: 18%; max-width: 110px; z-index: 60; }
        .flower-vase-right { right: 2%; bottom: -160px; width: 18%; max-width: 110px; z-index: 60; }
        .mandala-plate { left: 22%; bottom: -80px; width: 20%; max-width: 120px; z-index: 8; }
        .food-plate { right: 22%; bottom: -80px; width: 20%; max-width: 100px; z-index: 8; }

        /* 手機直式螢幕微調 */
        @media screen and (max-width: 500px) {
            .offerings-layer { bottom: 22%; }
            .lamp-left { bottom: 60px; }
            .lamp-right { bottom: 60px; }
            .water-bowl { bottom: -40px; }
        }

        /* --- 燭火動畫 --- */
        .flame-anim {
            width: 12px; height: 24px;
            background: radial-gradient(circle, #fff 0%, #ffcc00 40%, #ff6600 100%);
            border-radius: 50% 50% 20% 20%;
            position: absolute; top: 45%; left: 50%; transform: translateX(-50%);
            box-shadow: 0 0 15px #ff6600;
            animation: flicker 0.1s infinite alternate;
            display: none; z-index: 11;
        }
        .show .flame-anim { display: block; }

        @keyframes flicker {
            0% { transform: translateX(-50%) scale(1); opacity: 0.9; }
            100% { transform: translateX(-50%) scale(1.1) rotate(1deg); opacity: 1; }
        }

        /* --- 控制面板 --- */
        .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px 0 25px 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.95));
            z-index: 100;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }

        .btn {
            background: linear-gradient(to bottom, #f1c40f, #d4ac0d);
            border: 1px solid #f7dc6f;
            color: #5d4037;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            transition: 0.2s;
        }

        .btn:active { transform: scale(0.95); }
        .btn-reset { background: #641e16; color: #f1c40f; border: 1px solid #f1c40f; }
        
        /* 佛像切換按鈕樣式 */
        .btn-buddha { background: linear-gradient(to bottom, #8e44ad, #6c3483); color: #f1c40f; border: 1px solid #f1c40f; }

        /* --- 提示文字 (向上調整位置) --- */
        .message {
            position: absolute;
            bottom: 800px; /* 從 720px 調整為 800px，向上移動 */
            width: 100%;
            text-align: center;
            color: #f1c40f;
            font-size: 18px;
            text-shadow: 0 2px 10px rgba(0,0,0,1);
            z-index: 150;
            opacity: 0;
            transition: 0.8s;
            pointer-events: none;
        }

        /* 手機直式螢幕提示文字微調 (向上調整位置) */
        @media screen and (max-width: 576px) {
            .message { bottom: 85%; } /* 從 70% 調整為 85%，向上移動 */
        }
    </style>
</head>
<body>

<div id="app">
    <div class="message" id="msg-box">供養功德殊勝行</div>

    <div class="bg-layer"></div>

    <div class="buddha-layer">
        <img src="https://mingguang.im/gongfo/assets/img/foxiang/1.png" class="buddha-img" id="buddha-main-img" alt="佛像">
    </div>

    <div class="offerings-layer">
        <div class="offering lamp-left" id="vis-lamp-l">
            <div class="flame-anim"></div>
            <img src="https://mingguang.im/gongfo/assets/img/gd.png" width="100%" alt="燈">
        </div>
        <div class="offering lamp-right" id="vis-lamp-r">
            <div class="flame-anim"></div>
            <img src="https://mingguang.im/gongfo/assets/img/gd.png" width="100%" alt="燈">
        </div>

        <div class="offering water-bowl" id="vis-water">
            <img src="https://mingguang.im/gongfo/assets/img/gs.png" width="100%" alt="水">
        </div>

        <div class="offering flower-vase-left" id="vis-flower-l">
            <img src="https://mingguang.im/gongfo/assets/img/gh.png" width="100%" alt="花">
        </div>
        <div class="offering flower-vase-right" id="vis-flower-r">
            <img src="https://mingguang.im/gongfo/assets/img/gh.png" width="100%" alt="花">
        </div>

        <div class="offering incense-burner" id="vis-incense">
            <img src="https://mingguang.im/gongfo/assets/img/gx.png" width="100%" alt="香">
        </div>

        <div class="offering mandala-plate" id="vis-mandala">
            <img src="https://mingguang.im/gongfo/assets/img/mcl.png" width="100%" alt="曼札">
        </div>

        <div class="offering food-plate" id="vis-food">
            <img src="https://mingguang.im/gongfo/assets/img/gg.png" width="100%" alt="食子">
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-buddha" onclick="changeBuddha(-1)">◀ 上一位</button>
        <button class="btn" onclick="offer('lamp', '供燈功德：增長智慧，辨別是非')">供燈</button>
        <button class="btn" onclick="offer('water', '供水功德：心意調柔，健康無病')">供水</button>
        <button class="btn" onclick="offer('flower', '供花功德：容貌美麗，身體芳香')">供花</button>
        <button class="btn" onclick="offer('incense', '供香功德：罪障消除，所求如願')">供香</button>
        <button class="btn" onclick="offer('mandala', '供曼札功德：積集資糧，圓滿福慧')">供曼札</button>
        <button class="btn" onclick="offer('food', '供食子功德：消除匱乏，福報圓滿')">供食子</button>
        <button class="btn btn-buddha" onclick="changeBuddha(1)">下一位 ▶</button>
        <button class="btn btn-reset" onclick="resetAll()">再供一次</button>
    </div>
</div>

<script>
    // 佛像圖片陣列
    const buddhaImages = [
        { url: 'https://mingguang.im/gongfo/assets/img/foxiang/1.png', name: '釋迦牟尼佛', description: '本師釋迦牟尼佛，佛教創始人' },
        { url: 'https://biung-od.github.io/pandy/%E9%98%BF%E5%BD%8C%E9%99%80%E4%BD%9B.avif', name: '阿彌陀佛', description: '西方極樂世界教主，接引眾生' },
        { url: 'https://biung-od.github.io/pandy/%E8%97%A5%E5%B8%AB%E4%BD%9B.webp', name: '藥師佛', description: '東方淨琉璃世界教主，消災延壽' },
        { url: 'https://biung-od.github.io/pandy/%E5%9B%9B%E8%87%82%E8%A7%80%E9%9F%B3.webp', name: '觀世音菩薩', description: '大慈大悲，救苦救難' },
        { url: 'https://biung-od.github.io/pandy/%E5%9C%B0%E8%97%8F%E7%8E%8B%E8%8F%A9%E8%96%A9.webp', name: '地藏王菩薩', description: '地獄不空，誓不成佛' },
        { url: 'https://biung-od.github.io/pandy/%E6%96%87%E6%AE%8A%E8%8F%A9%E8%96%A9.avif', name: '文殊菩薩', description: '智慧第一，開發智慧' },
        { url: 'https://biung-od.github.io/pandy/%E7%B6%A0%E5%BA%A6%E6%AF%8D.webp', name: '綠度母', description: '救度八難，滿願迅速' }
    ];

    let currentBuddhaIndex = 0;

    // 初始化
    function initBuddha() {
        updateBuddhaDisplay(false); // 第一次載入不顯示提示文字
    }

    // 切換佛像
    function changeBuddha(direction) {
        currentBuddhaIndex += direction;
        if (currentBuddhaIndex < 0) currentBuddhaIndex = buddhaImages.length - 1;
        if (currentBuddhaIndex >= buddhaImages.length) currentBuddhaIndex = 0;
        updateBuddhaDisplay(true);
    }

    // 更新圖片顯示與淡入淡出
    function updateBuddhaDisplay(showMessage) {
        const buddhaImg = document.getElementById('buddha-main-img');
        const buddha = buddhaImages[currentBuddhaIndex];

        // 先變透明
        buddhaImg.style.opacity = 0;

        // 等待透明動畫結束後換圖
        setTimeout(() => {
            buddhaImg.onload = () => {
                buddhaImg.style.opacity = 1; // 載入完成後變回不透明
            };
            buddhaImg.onerror = () => {
                buddhaImg.src = 'https://via.placeholder.com/450x600?text=載入失敗';
                buddhaImg.style.opacity = 1;
            };
            buddhaImg.src = buddha.url;
            buddhaImg.alt = buddha.name;

            // 如果圖片有快取，onload 可能不會觸發，強制執行
            if (buddhaImg.complete) buddhaImg.onload();
        }, 300); // 配合 CSS 的 0.5s 動畫，稍微提早換圖

        // 顯示提示文字
        if (showMessage) {
            const msgBox = document.getElementById('msg-box');
            msgBox.innerText = `現前供養：${buddha.name} - ${buddha.description}`;
            msgBox.style.opacity = 1;
            setTimeout(() => {
                if(msgBox.innerText.includes(buddha.name)) msgBox.style.opacity = 0;
            }, 3000);
        }
    }

    // 供養功能 (原始邏輯)
    function offer(type, text) {
        document.getElementById('app').classList.add('light-up');

        if(type === 'lamp') {
            document.getElementById('vis-lamp-l').classList.add('show');
            document.getElementById('vis-lamp-r').classList.add('show');
        } else if (type === 'water') {
            document.getElementById('vis-water').classList.add('show');
        } else if (type === 'flower') {
            document.getElementById('vis-flower-l').classList.add('show');
            document.getElementById('vis-flower-r').classList.add('show');
        } else if (type === 'incense') {
            document.getElementById('vis-incense').classList.add('show');
        } else if (type === 'mandala') {
            document.getElementById('vis-mandala').classList.add('show');
        } else if (type === 'food') {
            document.getElementById('vis-food').classList.add('show');
        }

        const msgBox = document.getElementById('msg-box');
        msgBox.innerText = text;
        msgBox.style.opacity = 1;
        
        setTimeout(() => {
            if(msgBox.innerText === text) msgBox.style.opacity = 0;
        }, 3500);
    }

    // 重新供養
    function resetAll() {
        const items = document.querySelectorAll('.offering');
        items.forEach(item => item.classList.remove('show'));
        document.getElementById('app').classList.remove('light-up');

        const msgBox = document.getElementById('msg-box');
        msgBox.innerText = "心誠則靈，已重新整理";
        msgBox.style.opacity = 1;
        setTimeout(() => { msgBox.style.opacity = 0; }, 1500);
    }

    window.onload = initBuddha;
</script>

</body>
</html>
